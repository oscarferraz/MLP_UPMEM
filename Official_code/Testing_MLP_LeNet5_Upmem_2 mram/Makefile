HOST_BINARY := host
KDOT_SIGMOID_BINARY := KDOT_SIGMOID
KDOT_SIGMOID2_BINARY := KDOT_SIGMOID2
KDOT_SIGMOID3_BINARY := KDOT_SIGMOID3

HOST_SOURCES := host.c
DPU_SOURCES := KDOT_SIGMOID.c
DPU_SOURCES_1 := KDOT_SIGMOID2.c
DPU_SOURCES_2 := KDOT_SIGMOID3.c



.PHONY: all clean run

all: ${HOST_BINARY} ${KDOT_SIGMOID_BINARY} ${KDOT_SIGMOID2_BINARY} ${KDOT_SIGMOID3_BINARY}

clean:
	rm -f ${HOST_BINARY} ${KDOT_SIGMOID_BINARY} ${KDOT_SIGMOID2_BINARY} ${KDOT_SIGMOID3_BINARY}

run: all
	./${HOST_BINARY}

${HOST_BINARY}: ${KDOT_SIGMOID_BINARY} ${KDOT_SIGMOID2_BINARY} ${KDOT_SIGMOID3_BINARY} ${HOST_SOURCES}
	clang -O2 -DDPU_BINARY='"$(realpath ${KDOT_SIGMOID_BINARY})" "$(realpath ${KDOT_SIGMOID2_BINARY})" "$(realpath ${KDOT_SIGMOID3_BINARY})"' `dpu-pkg-config --cflags --libs dpu` ${HOST_SOURCES} -o $@

${KDOT_SIGMOID_BINARY}: ${DPU_SOURCES}
	clang --target=dpu-upmem-dpurte -DNR_TASKLETS=16 -O2 ${DPU_SOURCES} -o $@

${KDOT_SIGMOID2_BINARY}: ${DPU_SOURCES_1}
	clang --target=dpu-upmem-dpurte -DNR_TASKLETS=16 -O2 ${DPU_SOURCES_1} -o $@
${KDOT_SIGMOID3_BINARY}: ${DPU_SOURCES_2}
	clang --target=dpu-upmem-dpurte -DNR_TASKLETS=16 -O2 ${DPU_SOURCES_2} -o $@

